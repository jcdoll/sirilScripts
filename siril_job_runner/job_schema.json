{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Siril Job File",
  "description": "Configuration for a Siril image processing job",
  "type": "object",
  "required": ["name", "type", "calibration", "lights"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Job name for logging and output files",
      "minLength": 1
    },
    "type": {
      "type": "string",
      "enum": ["LRGB", "RGB", "SHO", "HOO", "LSHO", "LHOO"],
      "description": "Type of imaging data"
    },
    "calibration": {
      "type": "object",
      "description": "Dates for calibration data",
      "required": ["bias", "darks", "flats"],
      "properties": {
        "bias": {
          "type": "string",
          "pattern": "^\\d{4}_\\d{2}_\\d{2}$",
          "description": "Date for bias frames (YYYY_MM_DD)"
        },
        "darks": {
          "type": "string",
          "pattern": "^\\d{4}_\\d{2}_\\d{2}$",
          "description": "Date for dark frames (YYYY_MM_DD)"
        },
        "flats": {
          "type": "string",
          "pattern": "^\\d{4}_\\d{2}_\\d{2}$",
          "description": "Date for flat frames (YYYY_MM_DD)"
        }
      }
    },
    "lights": {
      "type": "object",
      "description": "Light frame directories per filter",
      "minProperties": 1,
      "additionalProperties": {
        "oneOf": [
          {
            "type": "string",
            "description": "Single directory path"
          },
          {
            "type": "array",
            "items": {
              "type": "string"
            },
            "minItems": 1,
            "description": "Multiple directory paths (multi-night or HDR)"
          }
        ]
      }
    },
    "output": {
      "type": "string",
      "description": "Output directory for processed files",
      "minLength": 1
    },
    "options": {
      "type": "object",
      "description": "Optional processing parameters. Any Config field can be overridden here.",
      "properties": {
        "temp_tolerance": {
          "type": "number",
          "minimum": 0,
          "description": "Temperature tolerance for calibration matching in Celsius (default: 2.0)"
        },
        "denoise": {
          "type": "boolean",
          "description": "Apply denoising (default: false)"
        },
        "palette": {
          "type": "string",
          "enum": ["HOO", "SHO", "SHO_FORAXX", "SHO_DYNAMIC", "SHO_GOLD", "SHO_WARM", "SHO_BLUEGOLD", "SHO_FORAXX_DYNAMIC", "HOO_FORAXX_DYNAMIC"],
          "description": "Narrowband palette for SHO/HOO types (default: SHO)"
        },
        "dark_temp_override": {
          "type": "number",
          "description": "Force using darks at this temperature (Celsius)"
        },
        "hdr_low_threshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "HDR blend low threshold - below this, use 100% long exposure (default: 0.7)"
        },
        "hdr_high_threshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "HDR blend high threshold - above this, use 100% short exposure (default: 0.9)"
        },
        "linear_match_low": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Linear match low percentile (default: 0.0)"
        },
        "linear_match_high": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Linear match high percentile (default: 0.92)"
        },
        "mtf_low": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "MTF stretch low value (default: 0.20)"
        },
        "mtf_mid": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "MTF stretch midtone value (default: 0.5)"
        },
        "mtf_high": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "MTF stretch high value (default: 1.0)"
        },
        "saturation_amount": {
          "type": "number",
          "description": "Saturation adjustment amount (default: 1.0)"
        },
        "saturation_threshold": {
          "type": "number",
          "description": "Saturation threshold (default: 0.0)"
        },
        "stack_rejection": {
          "type": "string",
          "description": "Stacking rejection method (default: rej)"
        },
        "stack_weighting": {
          "type": "string",
          "description": "Stacking weighting method (default: w)"
        },
        "stack_sigma_low": {
          "type": "string",
          "description": "Stacking low sigma value (default: 3)"
        },
        "stack_sigma_high": {
          "type": "string",
          "description": "Stacking high sigma value (default: 3)"
        },
        "stack_norm": {
          "type": "string",
          "description": "Stacking normalization method (default: addscale)"
        },
        "clipping_low_16bit": {
          "type": "integer",
          "description": "16-bit low clipping threshold (default: 100)"
        },
        "clipping_high_16bit": {
          "type": "integer",
          "description": "16-bit high clipping threshold (default: 65000)"
        },
        "clipping_warning_threshold": {
          "type": "number",
          "description": "Clipping warning percentage threshold (default: 0.01)"
        }
      },
      "additionalProperties": true
    }
  }
}
